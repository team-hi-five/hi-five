## ëª©ì°¨

[1. ê°œë°œ í™˜ê²½](https://www.notion.so/1a02435c61c98063ba25ea37d442076e?pvs=25)

[2. ë¹Œë“œ ì‹œ ì‚¬ìš©ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜](https://www.notion.so/1a02435c61c98063ba25ea37d442076e?pvs=25)

[3. ec2 ì„œë²„ ì„¤ì •](https://www.notion.so/1a02435c61c98063ba25ea37d442076e?pvs=25)

[4. properties íŒŒì¼](https://www.notion.so/1742435c61c9819d95dae13fe6202b1e)


## 1. ê°œë°œ í™˜ê²½

### Infra

- AWS EC2
- ubuntu 22.04.5
- JVM: Liberica JDK 17
- ì›¹ì„œë²„: nginx version â‡’ niginx/1.27.4
- WAS (Web Application Server): Tomcat

### Backend

- Java: `Liberica JDK 17`
- Spring Boot: `3.4.1`
- Spring Dependency Management: `1.1.7`
- Build Tool: `Gradle`
- IntelliJ IDEA: 2024.3.1.1

- ì¶”ê°€ì ì¸ ì •ë³´
    - Spring Security: `3.4.1`
    - Lombok: `1.18.36`
    - DevTools: `3.4.1`
    - JUnit: `5.11.4`
    - JUnit Platform Runner: Latest compatible version
    - JSON Simple: `1.1.1`
    - Spring Batch: `3.4.1`
    - Spring Quartz: `3.4.1`
    - SpringDoc OpenAPI UI: `2.7.0`
    - JJWT API: `0.11.5`
    - JJWT Impl: `0.11.5`
    - JJWT Jackson: `0.11.5`
    - Spring Mail Sender: `3.4.1`
    - OpenVidU Java Client: `2.31.0`
    - STOMP websocket:  `10.1.34`

### Frontend

- Vite: `^6.0.5`
- React: `^18.3.1`

- ì¶”ê°€ì ì¸ ì •ë³´
    - react-router-dom: `^7.1.3`
    - axios: `^1.7.9`
    - zustand: `^5.0.3`
    - three: `^0.172.0`
    - react-webcam: `^7.2.0`
    - openvidu-browser: `^2.31.0`
    - socket.io-client: `^4.7.2`
    - sockjs-client: `^1.6.1`
    - react-chatbot-kit: `^2.2.2`
    - string-similarity: `^4.0.4`
    - face-api.js: `^0.22.2`
    - framer-motion: `^12.0.6`
    - primeflex: `^3.3.1`
    - primeicons: `^7.0.0`
    - primereact: `^10.9.2`
    - chart.js: `^4.4.7`
    - quill: `^2.0.3`
    - sweetalert2: `^11.6.13`
    - swiper: `^11.2.4`
    - react-spring-3d-carousel: `^1.3.4`
    - react-responsive-carousel: `^3.2.23`

### AI

- GPT-4o API
- Google STT API
- Google TTS API
- Face-API
- Python: `3.10.7`
- Nodejs: `20.18.2`
- JavaScript:  ES6

### Database

- MySQL: `8.0.40`
- MongoDB: `27.5.1`
- Redis: `8.0.4`

## 2. ë¹Œë“œ ì‹œ ì‚¬ìš©ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜

| **DB_HOST** | mysql_h5 |
| --- | --- |
| **DB_PORT** | 3306 |
| **DB_USER** | mysql_h5 |
| **SERVER_URL** | [https://](https://i11a106.p.ssafy.io/)hi-five.site |
| **FILE_ACCESS_URL** | https://cdn.hi-five.site |
| **MAIL_USERNAME** | noreply.mail.h5@gmail.com |
| **MAIL_PASSWORD** | ghsnycgzibikbkpk |
| **OPENVIDU_URL** | https://hi-five.site/openvidu |
| **OPENVIDU_SECRET** | rz7FazDNZkSqkJmr |

## 3. ë°°í¬ ì‹œ íŠ¹ì´ì‚¬í•­ ê¸°ì¬

### ì¤€ë¹„ ê³¼ì •

1. **í¬íŠ¸ ì‚¬ìš© í™•ì¸**
í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ëª¨ë“  í¬íŠ¸ì™€ ê´€ë ¨ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    
    ```bash
    sudo netstat -tulnp
    ```
    

### 1. ìš°ë¶„íˆ¬ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸

1. **íŒ¨í‚¤ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸**
    
    ìš°ë¶„íˆ¬ ì‹œìŠ¤í…œì˜ íŒ¨í‚¤ì§€ ëª©ë¡ì„ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ì˜ ìµœì‹  ë²„ì „ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    
    ```jsx
    sudo apt-get updat
    ```
    
2. **í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜**
    
    Docker ì„¤ì¹˜ ë° ì¸ì¦ì„œ ê´€ë¦¬ë¥¼ ìœ„í•´ í•„ìš”í•œ í•„ìˆ˜ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    
    ```bash
    sudo apt-get install ca-certificates curl
    ```
    
3. **ë””ë ‰í† ë¦¬ ìƒì„±**
    
    apt í‚¤ë§ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ë””ë ‰í† ë¦¬ëŠ” Dockerì˜ GPG í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    
    ```bash
    sudo install -m 0755 -d /etc/apt/keyrings
    ```
    
    - `m 0755`: ë””ë ‰í† ë¦¬ì˜ ê¶Œí•œì„ `0755`ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  ì‚¬ìš©ìê°€ ë””ë ‰í† ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

### 2. Dockerì˜ ê³µì‹ GPG í‚¤ ì¶”ê°€

1. **GPG í‚¤ ë‹¤ìš´ë¡œë“œ ë° ì €ì¥**
    
    Dockerì˜ ê³µì‹ GPG í‚¤ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ apt í‚¤ë§ ë””ë ‰í† ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ GPG í‚¤ëŠ” Docker íŒ¨í‚¤ì§€ë¥¼ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    
    ```bash
    sudo curl -fsSL <https://download.docker.com/linux/ubuntu/gpg> -o /etc/apt/keyrings/docker.asc
    ```
    
2. **GPG í‚¤ íŒŒì¼ ê¶Œí•œ ì„¤ì •**
    
    ëª¨ë“  ì‚¬ìš©ìê°€ GPG í‚¤ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.
    
    ```bash
    sudo chmod a+r /etc/apt/keyrings/docker.asc
    ```
    

### 3. Dockerì˜ ê³µì‹ apt ì €ì¥ì†Œ ì¶”ê°€

1. **Docker apt ì €ì¥ì†Œ ì¶”ê°€**
    
    Docker íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ Dockerì˜ ê³µì‹ apt ì €ì¥ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì–´ëŠ” ìš°ë¶„íˆ¬ ì‹œìŠ¤í…œì— Dockerì˜ ì €ì¥ì†Œ ì£¼ì†Œë¥¼ ì¶”ê°€í•˜ì—¬ Docker íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
    
    ```bash
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] <https://download.docker.com/linux/ubuntu> $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
    
2. **íŒ¨í‚¤ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸**
    
    ìƒˆë¡œ ì¶”ê°€ëœ Docker ì €ì¥ì†Œë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ íŒ¨í‚¤ì§€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    
    ```bash
    sudo apt-get update
    ```
    

### 4. Docker íŒ¨í‚¤ì§€ ì„¤ì¹˜

1. **Docker ë° ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜**
Dockerì™€ Docker CLI, ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„, ë¹Œë“œ ë° Compose í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    
    ```bash
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    ```
    

### 5. Docker Compose ì„¤ì¹˜

1. **Docker Compose ë‹¤ìš´ë¡œë“œ**
    
    Docker Compose ë°”ì´ë„ˆë¦¬ë¥¼ `/usr/local/bin` ë””ë ‰í† ë¦¬ì— ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. ì´ ê²½ë¡œëŠ” ì‹œìŠ¤í…œ ì „ì—­ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ëœ ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.
    
    ```bash
    sudo curl -SL <https://github.com/docker/compose/releases/download/v2.28.1/docker-compose-linux-x86_64> -o /usr/local/bin/docker-compose
    ```
    
2. **Docker Compose ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬**
    
    Docker Compose íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ëª…ë ¹ì–´ë¡œ Docker Composeë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
    
    ```bash
    sudo chmod +x /usr/local/bin/docker-compose
    ```
    
3. **Docker Compose ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„±**
    
    Docker Composeì˜ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ `/usr/bin` ë””ë ‰í† ë¦¬ì— ìƒì„±í•˜ì—¬, ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
    
    ```bash
    sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
    ```
    
4. **Docker Compose ì„¤ì¹˜ í™•ì¸**
    
    Docker Composeê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë²„ì „ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
    
    ```bash
    docker-compose -v
    ```
    
5. **docker-compose.yml ì‘ì„±**
    
    ```coffeescript
    services:
      jenkins:
        container_name: jenkins
        build:
          context: ./jenkins
          dockerfile: jenkins.Dockerfile
        ports:
          - "8889:8080"
          - "50000:50000"
        volumes:
          - ./jenkins:/var/jenkins_home
          - /usr/bin/docker:/usr/bin/docker
          - /var/run/docker.sock:/var/run/docker.sock
          - /etc/localtime:/etc/localtime:ro
          - /etc/timezone:/etc/timezone:ro
    
      db :
        image: mysql:8.0.40
        container_name: mysql_h5
        restart: unless-stopped
        environment:
          MYSQL_ROOT_PASSWORD: zig2m6hS
          MYSQL_DATABASE: h5
          MYSQL_USER: mysql_h5
          MYSQL_PASSWORD: 6cN0A5Fl
        ports:
          - "3306:3306"
        command: --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci
        volumes:
          - db_data:/var/lib/mysql
          - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro
          - /etc/localtime:/etc/localtime:ro
          - /etc/timezone:/etc/timezone:ro
        healthcheck:
          test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
          interval: 5s
          timeout: 10s
          retries: 5
        networks:
          - app-network
    
      mongo:
        image: mongo:latest
        container_name: mongo
        restart: unless-stopped
        ports:
          - "27017:27017"
        volumes:
          - mongo_data:/data/db
          - /etc/localtime:/etc/localtime:ro
          - /etc/timezone:/etc/timezone:ro
        networks:
          - app-network
    
      redis:
        image: redis:latest
        container_name: redis
        restart: unless-stopped
        ports:
          - "6379:6379"
        networks:
          - app-network
    
      java_service:
        image: java_service:latest
        build:
          context: ./java_service
        container_name: java17_h5
        restart: unless-stopped
        ports:
          - "8443:8443"
        environment:
          - DB_HOST=mysql_h5
          - DB_PORT=3306
          - DB_USER=mysql_h5
          - DB_PASSWORD=6cN0A5Fl
          - SERVER_URL=https://hi-five.site
          - FILE_ACCESS_URL=https://cdn.hi-five.site
          - MAIL_USERNAME=noreply.mail.h5@gmail.com
          - MAIL_PASSWORD=ghsnycgzibikbkpk
          - OPENVIDU_URL=https://hi-five.site/openvidu
          - OPENVIDU_SECRET=rz7FazDNZkSqkJmr
        depends_on:
          db:
            condition: service_healthy
        volumes:
          - /home/project_h5/project/uploads:/home/project_h5/project/uploads
          - /etc/letsencrypt:/owncert:ro
          - /etc/localtime:/etc/localtime:ro
          - /etc/timezone:/etc/timezone:ro
        networks:
          - app-network
    
      nginx:
        image: nginx:latest
        container_name: nginx
        restart: unless-stopped
        ports:
          - "80:80"
          - "443:443"
        volumes:
          - ./nginx/conf.d:/etc/nginx/conf.d:ro
          - /etc/letsencrypt:/etc/nginx/ssl:ro
          - /home/project_h5/project/assets:/home/project_h5/project/assets:ro
          - /home/project_h5/project/uploads:/home/project_h5/project/uploads
          - /etc/localtime:/etc/localtime:ro
          - /etc/timezone:/etc/timezone:ro
        depends_on:
          - java_service
          - db
          - redis
          - mongo
        networks:
          - app-network
    
    volumes:
      db_data:
      mongo_data:
    
    networks:
      app-network:
        driver: bridge
    
    ```
    

### **Certbot(SSL) ì„¤ì¹˜**

1. **Certbot ì„¤ì¹˜**
    - SSL ì¸ì¦ì„œ ë°œê¸‰ì„ ìœ„í•´ Certbot íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    
    ```jsx
    sudo snap install --classic certbot
    ```
    
2. **Certbot ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì • ìˆ˜í–‰**
    - ë„ë©”ì¸ ì†Œìœ ê¶Œ í™•ì¸ì„ ìœ„í•´ ìˆ˜ë™ ëª¨ë“œë¡œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
    
    ```jsx
    sudo certbot certonly --manual
    ```
    
    - ë„ë©”ì¸ ì´ë¦„ì„ ì…ë ¥í•˜ê³ , IP ë¡œê·¸ ë™ì˜ ì—¬ë¶€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
3. **ë„ì „ íŒŒì¼ ìƒì„± ë° Nginx ì„¤ì • í™•ì¸**
    - ë„ì „ íŒŒì¼ì„ ìƒì„±í•˜ê³  Nginx ì„¤ì •ì„ í™•ì¸í•˜ì—¬ SSL ì¸ì¦ì„œë¥¼ ì ìš©í•©ë‹ˆë‹¤.
4. **Nginx ì¬ì‹œì‘**
    - ì„¤ì •ì´ ì™„ë£Œëœ í›„ Nginxë¥¼ ì¬ì‹œì‘í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•©ë‹ˆë‹¤.
    
    ```jsx
    sudo nginx -t
    sudo systemctl reload nginx
    ```
    

### OpenVidu ì„¤ì¹˜ ë° ì„¤ì •

1. **OpenVidu ì„¤ì¹˜**
    
    OpenVidu í”Œë«í¼ì„ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ `/opt` ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ì—¬ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    ```bash
    cd /opt
    curl <https://s3-eu-west-1.amazonaws.com/aws.openvidu.io/install_openvidu_latest.sh> | bash
    ```
    
2. **í™˜ê²½ ì„¤ì • íŒŒì¼ ìˆ˜ì •**
    
    `.env` íŒŒì¼ì—ì„œ OpenVidu í”Œë«í¼ì˜ ë„ë©”ì¸ ë˜ëŠ” ê³µìš© IP ì£¼ì†Œ, OpenVidu Secret ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
    
    - `DOMAIN_OR_PUBLIC_IP`: OpenVidu ì„œë²„ì— ë„ë©”ì¸ ì£¼ì†Œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
    - `OPENVIDU_SECRET`: OpenVidu í”Œë«í¼ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    - `CERTIFICATE_TYPE` : SSL ì¸ì¦ì„œ ì‚¬ìš©ì„ ìœ„í•œ letsencryptë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    - `LETSENCRYPT_EMAIL` : letsencrypt ì¸ì¦ì„œ ìƒì„±ì— ì‚¬ìš©í•œ ì´ë©”ì¼ì„ ì…ë ¥í•©ë‹ˆë‹¤.
    - `HTTPS_PORT=4443` : https ì‚¬ìš©ì„ ìœ„í•œ í¬íŠ¸ë¥¼ 4443ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    - `OPENVIDU_RECORDING=true` : ì˜ìƒ ë…¹í™” ê¸°ëŠ¥ì„ ìœ„í•´ trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    - `OPENVIDU_PUBLICURL=https://hi-five.site/openvidu` : Openvidu ì›¹ì†Œì¼“ ì‚¬ìš©ì„ ìœ„í•´ PUBLIC URLì„ ì…ë ¥í•©ë‹ˆë‹¤.
    
    ```jsx
    # OpenVidu configuration
    # ----------------------
    # Documentation: https://docs.openvidu.io/en/stable/reference-docs/openvidu-config/
    
    # NOTE: This file doesn't need to quote assignment values, like most shells do.
    # All values are stored as-is, even if they contain spaces, so don't quote them.
    
    # Domain name. If you do not have one, the public IP of the machine.
    # For example: 198.51.100.1, or openvidu.example.com
    DOMAIN_OR_PUBLIC_IP=hi-five.site
    
    # OpenVidu SECRET used for apps to connect to OpenVidu server and users to access to OpenVidu Dashboard
    OPENVIDU_SECRET=rz7FazDNZkSqkJmr
    # Certificate type:
    # - selfsigned:  Self signed certificate. Not recommended for production use.
    #                Users will see an ERROR when connected to web page.
    # - owncert:     Valid certificate purchased in a Internet services company.
    #                Please put the certificates files inside folder ./owncert
    #                with names certificate.key and certificate.cert
    # - letsencrypt: Generate a new certificate using letsencrypt. Please set the
    #                required contact email for Let's Encrypt in LETSENCRYPT_EMAIL
    #                variable.
    CERTIFICATE_TYPE=letsencrypt
    
    # If CERTIFICATE_TYPE=letsencrypt, you need to configure a valid email for notifications
    LETSENCRYPT_EMAIL=chanhoan01@gmail.com
    
    # Proxy configuration
    # If you want to change the ports on which openvidu listens, uncomment the following lines
    
    # Allows any request to http://DOMAIN_OR_PUBLIC_IP:HTTP_PORT/ to be automatically
    # redirected to https://DOMAIN_OR_PUBLIC_IP:HTTPS_PORT/.
    # WARNING: the default port 80 cannot be changed during the first boot
    # if you have chosen to deploy with the option CERTIFICATE_TYPE=letsencrypt
    HTTP_PORT=4040
    
    # Changes the port of all services exposed by OpenVidu.
    # SDKs, REST clients and browsers will have to connect to this port
    HTTPS_PORT=4443
    
    # Old paths are considered now deprecated, but still supported by default.
    # OpenVidu Server will log a WARN message every time a deprecated path is called, indicating
    # the new path that should be used instead. You can set property SUPPORT_DEPRECATED_API=false
    # to stop allowing the use of old paths.
    # Default value is true
    # SUPPORT_DEPRECATED_API=false
    
    # If true request to with www will be redirected to non-www requests
    # Default value is false
    # REDIRECT_WWW=false
    
    # How many workers to configure in nginx proxy.
    # The more workers, the more requests will be handled
    # Default value is 10240
    # WORKER_CONNECTIONS=10240
    
    # Access restrictions
    # In this section you will be able to restrict the IPs from which you can access to
    # Openvidu API and the Administration Panel
    # WARNING! If you touch this configuration you can lose access to the platform from some IPs.
    # Use it carefully.
    
    # This section limits access to the /dashboard (OpenVidu CE) and /inspector (OpenVidu Pro) pages.
    # The form for a single IP or an IP range is:
    # ALLOWED_ACCESS_TO_DASHBOARD=198.51.100.1 and ALLOWED_ACCESS_TO_DASHBOARD=198.51.100.0/24
    # To limit multiple IPs or IP ranges, separate by commas like this:
    # ALLOWED_ACCESS_TO_DASHBOARD=198.51.100.1, 198.51.100.0/24
    ALLOWED_ACCESS_TO_DASHBOARD=0.0.0.0/0
    
    # This section limits access to the Openvidu REST API.
    # The form for a single IP or an IP range is:
    # ALLOWED_ACCESS_TO_RESTAPI=198.51.100.1 and ALLOWED_ACCESS_TO_RESTAPI=198.51.100.0/24
    # To limit multiple IPs or or IP ranges, separate by commas like this:
    # ALLOWED_ACCESS_TO_RESTAPI=198.51.100.1, 198.51.100.0/24
    # ALLOWED_ACCESS_TO_RESTAPI=
    
    # Whether to enable recording module or not
    OPENVIDU_RECORDING=true
    
    # Use recording module with debug mode.
    OPENVIDU_RECORDING_DEBUG=true
    
    # Openvidu Folder Record used for save the openvidu recording videos. Change it
    # with the folder you want to use from your host.
    OPENVIDU_RECORDING_PATH=/opt/openvidu/recordings
    
    # System path where OpenVidu Server should look for custom recording layouts
    OPENVIDU_RECORDING_CUSTOM_LAYOUT=/opt/openvidu/custom-layout
    
    # if true any client can connect to
    # https://OPENVIDU_SERVER_IP:OPENVIDU_PORT/recordings/any_session_file.mp4
    # and access any recorded video file. If false this path will be secured with
    # OPENVIDU_SECRET param just as OpenVidu Server dashboard at
    # https://OPENVIDU_SERVER_IP:OPENVIDU_PORT
    # Values: true | false
    OPENVIDU_RECORDING_PUBLIC_ACCESS=false
    
    # Which users should receive the recording events in the client side
    # (recordingStarted, recordingStopped). Can be all (every user connected to
    # the session), publisher_moderator (users with role 'PUBLISHER' or
    # 'MODERATOR'), moderator (only users with role 'MODERATOR') or none
    # (no user will receive these events)
    OPENVIDU_RECORDING_NOTIFICATION=publisher_moderator
    
    # Timeout in seconds for recordings to automatically stop (and the session involved to be closed)
    # when conditions are met: a session recording is started but no user is publishing to it or a session
    # is being recorded and last user disconnects. If a user publishes within the timeout in either case,
    # the automatic stop of the recording is cancelled
    # 0 means no timeout
    OPENVIDU_RECORDING_AUTOSTOP_TIMEOUT=120
    
    # Maximum video bandwidth sent from clients to OpenVidu Server, in kbps.
    # 0 means unconstrained
    OPENVIDU_STREAMS_VIDEO_MAX_RECV_BANDWIDTH=1000
    
    # Minimum video bandwidth sent from clients to OpenVidu Server, in kbps.
    # 0 means unconstrained
    OPENVIDU_STREAMS_VIDEO_MIN_RECV_BANDWIDTH=300
    
    # Maximum video bandwidth sent from OpenVidu Server to clients, in kbps.
    # 0 means unconstrained
    OPENVIDU_STREAMS_VIDEO_MAX_SEND_BANDWIDTH=1000
    
    # Minimum video bandwidth sent from OpenVidu Server to clients, in kbps.
    # 0 means unconstrained
    OPENVIDU_STREAMS_VIDEO_MIN_SEND_BANDWIDTH=300
    
    # All sessions of OpenVidu will try to force this codec. If OPENVIDU_STREAMS_ALLOW_TRANSCODING=true
    # when a codec can not be forced, transcoding will be allowed
    # Values: MEDIA_SERVER_PREFERRED, NONE, VP8, VP9, H264
    # Default value is MEDIA_SERVER_PREFERRED
    # OPENVIDU_STREAMS_FORCED_VIDEO_CODEC=MEDIA_SERVER_PREFERRED
    
    # Allow transcoding if codec specified in OPENVIDU_STREAMS_FORCED_VIDEO_CODEC can not be applied
    # Values: true | false
    # Default value is false
    # OPENVIDU_STREAMS_ALLOW_TRANSCODING=false
    
    # true to enable OpenVidu Webhook service. false' otherwise
    # Values: true | false
    OPENVIDU_WEBHOOK=false
    
    # HTTP endpoint where OpenVidu Server will send Webhook HTTP POST messages
    # Must be a valid URL: http(s)://ENDPOINT
    #OPENVIDU_WEBHOOK_ENDPOINT=
    
    # List of headers that OpenVidu Webhook service will attach to HTTP POST messages
    #OPENVIDU_WEBHOOK_HEADERS=
    
    # List of events that will be sent by OpenVidu Webhook service
    # Default value is all available events
    OPENVIDU_WEBHOOK_EVENTS=[sessionCreated,sessionDestroyed,participantJoined,participantLeft,webrtcConnectionCreated,webrtcConnectionDestroyed,recordingStatusChanged,filterEventDispatched,mediaNodeStatusChanged,nodeCrashed,nodeRecovered,broadcastStarted,broadcastStopped]
    
    # How often the garbage collector of non active sessions runs.
    # This helps cleaning up sessions that have been initialized through
    # REST API (and maybe tokens have been created for them) but have had no users connected.
    # Default to 900s (15 mins). 0 to disable non active sessions garbage collector
    OPENVIDU_SESSIONS_GARBAGE_INTERVAL=900
    
    # Minimum time in seconds that a non active session must have been in existence
    # for the garbage collector of non active sessions to remove it. Default to 3600s (1 hour).
    # If non active sessions garbage collector is disabled
    # (property 'OPENVIDU_SESSIONS_GARBAGE_INTERVAL' to 0) this property is ignored
    OPENVIDU_SESSIONS_GARBAGE_THRESHOLD=3600
    
    # Call Detail Record enabled
    # Whether to enable Call Detail Record or not
    # Values: true | false
    OPENVIDU_CDR=false
    
    # Path where the cdr log files are hosted
    OPENVIDU_CDR_PATH=/opt/openvidu/cdr
    
    # Kurento Media Server image
    # --------------------------
    # Docker hub kurento media server: https://hub.docker.com/r/kurento/kurento-media-server
    # Uncomment the next line and define this variable with KMS image that you want use
    # KMS_IMAGE=kurento/kurento-media-server:7.1.1
    
    # Kurento Media Server Level logs
    # -------------------------------
    # Uncomment the next line and define this variable to change
    # the verbosity level of the logs of KMS
    # Documentation: https://doc-kurento.readthedocs.io/en/stable/features/logging.html
    # KMS_DOCKER_ENV_GST_DEBUG=
    
    # Openvidu Server Level logs
    # --------------------------
    # Uncomment the next line and define this variable to change
    # the verbosity level of the logs of Openvidu Service
    # RECOMENDED VALUES: INFO for normal logs DEBUG for more verbose logs
    # OV_CE_DEBUG_LEVEL=INFO
    
    # Java Options
    # --------------------------
    # Uncomment the next line and define this to add
    # options to java command
    # Documentation: https://docs.oracle.com/cd/E37116_01/install.111210/e23737/configuring_jvm.htm#OUDIG00058
    JAVA_OPTIONS="-Xms2048m -Xmx4096m -Duser.timezone=Asia/Seoul"
    
    OPENVIDU_PUBLICURL=https://hi-five.site/openvidu
    
    OPENVIDU_STREAMS_ALLOW_TRANSCODING=true
    
    ```
    

### **Front-end ì„¤ì •**

1. **Git Clone**
    - í”„ë¡œì íŠ¸ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¡œì»¬ í™˜ê²½ìœ¼ë¡œ í´ë¡ í•©ë‹ˆë‹¤.
    
    ```bash
    git clone <repository ì£¼ì†Œ>
    ```
    
2. **í´ë” ì´ë™**
    - í´ë¡ í•œ í”„ë¡œì íŠ¸ì˜ front ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤.
    
    ```bash
    cd front
    ```
    
3. **ë¸Œëœì¹˜ ë³€ê²½ ë° ì½”ë“œ ìµœì‹ í™”**
    - ì‘ì—…í•  ë¸Œëœì¹˜ë¡œ ì´ë™í•œ í›„, ìµœì‹  ì½”ë“œë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.
    
    ```bash
    git checkout <branch ì´ë¦„>
    git pull
    ```
    
4. **í”„ë¡œë•ì…˜ ë¹Œë“œ ì‹¤í–‰**
    - í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ì—¬ ë°°í¬ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ë§Œë“­ë‹ˆë‹¤.
    
    ```bash
    npm run build
    ```
    
5. **Nginx ì„¤ì • íŒŒì¼ ì‘ì„± ë° ë¬¸ë²• ê²€ì‚¬**
    - Nginx ì„¤ì • íŒŒì¼ ì‘ì„±
    
    ```coffeescript
    server {
        listen 443 ssl;
        server_name hi-five.site;  # ë©”ì¸ ë„ë©”ì¸
    
        ssl_certificate /etc/nginx/ssl/live/hi-five.site/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/live/hi-five.site/privkey.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
    
        client_max_body_size 100M;
    
        # ë°±ì—”ë“œ API í”„ë¡ì‹œ ì„¤ì •
        location /api/ {
            proxy_pass https://java17_h5:8443/api/;
            proxy_ssl_server_name on;
            proxy_ssl_name hi-five.site;
            proxy_ssl_verify off;
            proxy_ssl_trusted_certificate /etc/nginx/ssl/live/hi-five.site/ca.pem;
            proxy_ssl_verify_depth 2;
    
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
    
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;
        }
    
        # OpenVidu í”„ë¡ì‹œ ì„¤ì • ì¶”ê°€
        location /openvidu/ {
            proxy_pass https://hi-five.site:4443/openvidu/;
            proxy_ssl_server_name on;
    
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;
        }
    
        location /openvidu {
            proxy_pass https://hi-five.site:4443/openvidu;
            proxy_ssl_server_name on;
    
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    
        location /api/uploads/ {
            alias /home/project_h5/project/uploads/;
            autoindex on;
        }
    
        # ğŸ“Œ ê¸°ì¡´ í”„ë¡ íŠ¸ì—”ë“œ ì •ì  íŒŒì¼ ìœ ì§€ (/usr/share/nginx/html)
        root /usr/share/nginx/html;
        index index.html;
    
        location / {
            try_files $uri $uri/ /index.html;
        }
    
        location /child {
            root /usr/share/nginx/html;
            index index.html;
            try_files /index.html =404;
        }
    
        # ğŸ“Œ `/assets/`ëŠ” ê¸°ì¡´ëŒ€ë¡œ ìœ ì§€ (í”„ë¡ íŠ¸ì—”ë“œ ì •ì  íŒŒì¼ ì œê³µ)
        location /assets/ {
            root /usr/share/nginx/html;
        }
    
        # ğŸ“Œ JS, CSS, ì´ë¯¸ì§€ ë“±ì˜ ì •ì  íŒŒì¼ ì²˜ë¦¬ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
        location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|ttf|svg)$ {
            root /usr/share/nginx/html;
            expires 6M;
            access_log off;
            add_header Cache-Control "public";
        }
    }
    
    server {
        listen 443 ssl;
        server_name cdn.hi-five.site;  # CDN ì—­í• ì„ í•˜ëŠ” ì„œë¸Œë„ë©”ì¸
    
        ssl_certificate /etc/nginx/ssl/live/hi-five.site/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/live/hi-five.site/privkey.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
    
        # ğŸ“Œ `/assets/` ê²½ë¡œë¥¼ í”„ë¡œì íŠ¸ í´ë”ë¡œ ë§¤í•‘
        location /assets/ {
            alias /home/project_h5/project/assets/;
            autoindex off;
        }
    
        location /uploads/ {
            alias /home/project_h5/project/uploads/;
            autoindex off;
        }
    }
    
    server {
        listen 80;
        server_name hi-five.site cdn.hi-five.site;  # http â†’ https ë¦¬ë””ë ‰íŠ¸
        return 301 https://$host$request_uri;
    }
    
    ```
    
    - Nginx ì„¤ì • íŒŒì¼ì˜ ë¬¸ë²•ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    
    ```bash
    sudo nginx -t
    ```
    
6. **Nginx ì¬ì‹œì‘**
    - Nginx ì„¤ì •ì´ ì˜¬ë°”ë¥´ë‹¤ë©´ ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ì—¬ ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•©ë‹ˆë‹¤.
    
    ```bash
    sudo systemctl restart nginx
    ```
    

### Jenkins ì´ˆê¸° ì„¤ì •

1. **Jenkins ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ í™•ì¸**
    
    Jenkins ì´ˆê¸° ì„¤ì •ì„ ìœ„í•´, Jenkins ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸ì—ì„œ ì´ˆê¸° ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” Jenkins ì›¹ ì¸í„°í˜ì´ìŠ¤ì— ì²˜ìŒìœ¼ë¡œ ë¡œê·¸ì¸í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    
    ```bash
    sudo docker logs [Jenkinsì˜ ContainerID]
    ```
    
    - `[Jenkinsì˜ ContainerID]`ëŠ” ì‹¤í–‰ ì¤‘ì¸ Jenkins ì»¨í…Œì´ë„ˆì˜ IDì…ë‹ˆë‹¤.
2. **Jenkins Pipeline êµ¬ì¶•**
    - **Credential ì„¤ì •**: GitLab API Tokenì„ ë°œê¸‰ë°›ì•„ Jenkinsì˜ Credentialë¡œ ë“±ë¡í•©ë‹ˆë‹¤.
    - **Pipeline ìƒì„±**: Jenkins Dashboardì—ì„œ ìƒˆë¡œìš´ Itemì„ ìƒì„±í•˜ê³ , Pipeline ìœ í˜•ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
3. **Jenkins Pipeline Script ì‘ì„± ë° ì‹¤í–‰**
    
    Jenkins íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ë“¤ì„ ìë™í™”í•©ë‹ˆë‹¤:
    
    - Git ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì†ŒìŠ¤ ì½”ë“œ í´ë¡ 
    - Gradleì„ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ
    - Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ ë° ì‹¤í–‰
    - Docker ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
    
    ```coffeescript
    pipeline {
        agent any
    
        environment {
            BACKEND_IMAGE   = "java_service"
            BACKEND_TAG     = "latest"
            FRONTEND_IMAGE  = "nginx"
            FRONTEND_TAG    = "latest"
            
            DOCKER_COMPOSE_FILE = "project/docker-compose.yml"
        }
    
        stages {
    
            stage('Checkout') {
                steps {
                    checkout scm
                }
            }
    
            stage('Build Backend') {
                steps {
                    dir('backend') {
                        withCredentials([file(credentialsId: 'app-properties', variable: 'APP_PROPS')]) {
                            sh 'mkdir -p src/main/resources'
                            sh 'cp $APP_PROPS src/main/resources/application.properties'
                        }
    
                        sh 'chmod +x gradlew'
                        sh './gradlew clean build'
                        
                        sh """
                           docker build \
                             --build-arg JAR_FILE=build/libs/backend-0.0.1-SNAPSHOT.jar \
                             -t ${env.BACKEND_IMAGE}:${env.BACKEND_TAG} .
                        """
                    }
                }
            }
    
            stage('Build Frontend') {
                steps {
                    dir('frontend/h5') {
                        withCredentials([file(credentialsId: 'frontend-env', variable: 'FRONT_ENV')]) {
                            sh "cp \"$FRONT_ENV\" .env"
                        }
                        
                        script {
                            docker.image('node:22').inside {
                                sh 'npm install'
                                sh 'npm run build'
                            }
                        }
                        
                        sh "docker build -t ${env.FRONTEND_IMAGE}:${env.FRONTEND_TAG} ."
                    }
                }
            }
    
            stage('Deploy') {
                steps {
                    script {
                        echo "ê¸°ì¡´ java_service ë° nginx ì»¨í…Œì´ë„ˆë¥¼ ì¤‘ì§€ ë° ì œê±°í•©ë‹ˆë‹¤."
                        sh "docker-compose -f ${env.DOCKER_COMPOSE_FILE} stop java_service nginx || true"
                        sh "docker-compose -f ${env.DOCKER_COMPOSE_FILE} rm -f java_service nginx || true"
                        
                        echo "ìƒˆ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ê¸°ë™í•©ë‹ˆë‹¤."
                        sh "docker-compose -f ${env.DOCKER_COMPOSE_FILE} up -d java_service nginx"
                    }
                }
            }
            
            stage('Cleanup Images') {
                steps {
                    script {
                        echo "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€ ì •ë¦¬ ì¤‘..."
                        // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ì»¨í…Œì´ë„ˆì—ì„œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ë“¤ë§Œ ì‚­ì œë©ë‹ˆë‹¤.
                        sh 'docker image prune -a -f'
                    }
                }
            }
    
        }
    
        post {
            success {
                echo "ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            }
            failure {
                echo "ë°°í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤."
            }
            always {
                cleanWs()
            }
        }
    }
    
    ```
    

## **4. DB ì ‘ì† ì •ë³´**

- **MySQL**

| **DB_URL** | jdbc:mysql://db:3306/h5 |
| --- | --- |
| **DB_USERNAME** | mysql_h5 |
| **DB_PASSWORD** | 6cN0A5Fl |
- **MongoDB**

| **DB_URI** | mongodb://mongo:27017/h5mongo |
| --- | --- |
| **DB** | h5mongo |
- **Redis**

| **REDIS_HOST** | redis |
| --- | --- |
| **REDIS_PORT** | 6379 |

## 5. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì •ë³´

### Gmail SMTP

1. Google ê³„ì •ì—ì„œ 2ë‹¨ê³„ ì¸ì¦ì„ í•œ ì´í›„ ì•± ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰ë°›ê¸°
2. Gmailì— ë“¤ì–´ê°€ì„œ ì„¤ì • ëª¨ë‘ ë³´ê¸° ëˆ„ë¥´ê¸°
3. [ì „ë‹¬ ë° POP/IMAP](https://mail.google.com/mail/u/0/?tab=rm&ogbl#settings/fwdandpop) ë¡œ ë“¤ì–´ê°€ì„œ í•„ìš”í•œ ì„¤ì • í•˜ê¸°
4. build.gradle ì— ì¶”ê°€
    
    ```java
    implementation 'org.springframework.boot:spring-boot-starter-mail'
    ```
    
5. application.propertiesì— ì•± ë¹„ë°€ë²ˆí˜¸ ë“±ì„ ì…ë ¥
    
    ```java
    spring.mail.host=smtp.gmail.com
    spring.mail.port=587
    spring.mail.username=${MAIL_USERNAME}
    spring.mail.password=${MAIL_PASSWORD}
    spring.mail.protocol=smtp
    spring.mail.properties.mail.smtp.auth=true
    spring.mail.properties.mail.smtp.starttls.enable=true
    ```